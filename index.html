<!DOCTYPE html>
<html>
<head>
  <title>Mapbox DC Lunch üòã</title>
  <script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css' rel='stylesheet' />
</head>
<style>
  h1 {
    font-size: 2em;
    font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;
    font-weight: 700;
  }

  .c-header {
    padding: 3em 1em;
    text-align: center;
  }

  .c-map {
    position: relative;
    height: 500px;
    width: 100%;
  }
</style>
<body>
  <div class="c-header">
    <h1>üçîüå≠üçïüåÆüçù near Mapbox</h1>
  </div>
  <div class="c-map" id="map"></div>
</body>
<script>

  L.mapbox.accessToken = 'pk.eyJ1IjoiYWxseXBhbGFuemkiLCJhIjoiY2l3ZG1ndmJmMDZybjJvb2J3MTJzazQwaSJ9.yXhNtLrHo7t5xBBcmfSxHA';
  var map = L.mapbox.map('map', 'mapbox.streets');
  var DEFAULT_COLOR = '#ed6498';
  var CLIENT_ID = 'JIOLJU0WK1WJ3YHI3I2KFIJUVXLTKEFZ0WV0T3OCALBNUM0M';
  var CLIENT_SECRET = 'HMF0OAO0LZFC1E2NQ2KJN3J53YOMU20OKM3MPFIFZ4JNBVZ4';
  var API_ENDPOINT = 'https://api.foursquare.com/v2/venues/explore' +
    '?ll=38.9131907,-77.03267779999999' +
    '&client_id=' + CLIENT_ID +
    '&client_secret=' + CLIENT_SECRET +
    '&section=food' +
    '&v=20161206';

  // Set view to be Mapbox's office area
  map.setView([38.9131907, -77.03267779999999], 15);

  // Add a Mapbox marker to the map
  var mapboxMarker = L.mapbox.featureLayer({
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [-77.03267779999999, 38.9131907]
    },
    properties: {
      title: 'Mapbox Office!',
      'marker-color': DEFAULT_COLOR
    }
  }).addTo(map);

  // Open Mapbox marker on load
  mapboxMarker.eachLayer(function(m) {
    m.openPopup();
  });

  // Fetch data, convert to json
  fetch(API_ENDPOINT).then(function(response) {
      return response.json();
    }).then(function(data) {
      var venues = data.response.groups[0].items;
      // Turn venues into markers
      for (var i = 0; i < venues.length; i++) {
        var venue = venues[i].venue;
        var latlng = L.latLng(venue.location.lat, venue.location.lng);
        var color = venue.ratingColor;
        L.marker(latlng, {
          icon: L.mapbox.marker.icon({
            'marker-color': '#' + color
          })
        })
        // Add names & links to popups
        .bindPopup('<strong><a href="https://foursquare.com/v/' + venue.id + '">' + venue.name + '</a></strong>').addTo(map);
      }
    }).catch(function() {
      alert('Error getting data, sorry :(');
    });
</script>
</html>